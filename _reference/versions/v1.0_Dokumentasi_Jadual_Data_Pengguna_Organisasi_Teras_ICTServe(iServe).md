# Dokumentasi Jadual Data Pengguna & Organisasi Teras ICTServe (iServe) v2.0

| Atribut              | Nilai                                                       |
| -------------------- | ----------------------------------------------------------- |
| **Versi Dokumen**    | 3.0.0                                                       |
| **Tarikh Kemaskini** | 6 Oktober 2025                                              |
| **Status**           | Aktif                                                       |
| **Klasifikasi**      | Dokumentasi Teknikal Dalaman                                |
| **Penulis**          | Pasukan Pembangunan ICTServe                                |
| **Sasaran Audiens**  | Pembangun Sistem, Pentadbir Pangkalan Data, Jurutera Sistem |

## Kandungan

- [Pengenalan](#pengenalan)
- [Prasyarat dan Keperluan](#prasyarat-dan-keperluan)
- [Jadual Data Pengguna & Organisasi Teras](#jadual-data-pengguna--organisasi-teras)
- [Jadual Pengurusan Peralatan ICT](#jadual-pengurusan-peralatan-ict)
- [Jadual Modul Pinjaman ICT](#jadual-modul-pinjaman-ict)
- [Jadual Modul Helpdesk & Sokongan ICT](#jadual-modul-helpdesk--sokongan-ict)
- [Jadual Aliran Kerja & Utiliti Berkongsi](#jadual-aliran-kerja--utiliti-berkongsi)
- [Senarai Semak Pematuhan](#senarai-semak-pematuhan)
- [Panduan Pelaksanaan](#panduan-pelaksanaan)
- [Sejarah Revisi](#sejarah-revisi)
- [Sokongan dan Bantuan](#sokongan-dan-bantuan)

## Pengenalan

### Tujuan Dokumen

Dokumen ini menyediakan gambaran keseluruhan komprehensif mengenai skema pangkalan data teras dalam Sistem Pengurusan Perkhidmatan ICT MOTAC (ICTServe) versi 2.0. Ia berfungsi sebagai rujukan utama untuk pembangun sistem, pentadbir pangkalan data, dan arkitek sistem dalam memahami struktur, hubungan, dan tujuan setiap jadual dalam sistem.

### Skop Dokumen

Dokumentasi ini merangkumi:

- Struktur dan tujuan jadual pangkalan data teras
- Hubungan antara jadual (foreign keys, constraints)
- Komponen Laravel yang berkaitan untuk setiap jadual
- Implementasi prinsip reka bentuk kerajaan
- Garis panduan pelaksanaan dan penyelenggaraan

### Prinsip Reka Bentuk Berkaitan

Reka bentuk pangkalan data ICTServe mematuhi prinsip-prinsip utama berikut:

| Prinsip                   | Pelaksanaan dalam Pangkalan Data                                                  |
| ------------------------- | --------------------------------------------------------------------------------- |
| **Berpaksikan Rakyat**    | Struktur data direka untuk memenuhi keperluan sebenar pengguna dan operasi harian |
| **Berpacukan Data**       | Jejak audit lengkap, timestamps, dan metadata untuk analisis dan laporan          |
| **Kandungan Terancang**   | Penamaan konsisten, dokumentasi medan, dan struktur hierarki yang jelas           |
| **Teknologi Bersesuaian** | Menggunakan Laravel Eloquent ORM, migrasi, dan best practices                     |
| **Struktur Hierarki**     | Model organisasi dan kategori disusun secara hierarki                             |
| **Komunikasi**            | Sokongan untuk sistem notifikasi dan komen berantai                               |

## Prasyarat dan Keperluan

### Keperluan Sistem

- **Laravel Framework:** 12.x atau lebih tinggi
- **PHP:** 8.2 atau lebih tinggi
- **MySQL:** 8.0 atau lebih tinggi
- **Redis:** 7.0 atau lebih tinggi (untuk cache dan session)

### Pakej Laravel yang Diperlukan

```composer
"spatie/laravel-permission": "^6.0"
"owen-it/laravel-auditing": "^13.0"
"directory-tree/ldap-record": "^3.4"
"filament/filament": "^4.0"
```

### Konfigurasi Pangkalan Data

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=ictserve
DB_USERNAME=ictserve_user
DB_PASSWORD=secure_password
```

## Jadual Data Pengguna & Organisasi Teras

Jadual-jadual ini mendasari pengurusan pengguna, peranan, dan struktur organisasi, sejajar dengan prinsip **Berpaksikan Rakyat**, **Komunikasi**, dan **Struktur Hierarki**.

### 1. Jadual `users` (Pengguna Sistem)

Jadual utama yang menyimpan maklumat semua pengguna sistem ICTServe.

#### Struktur Jadual: users

```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,
    title VARCHAR(50),
    name VARCHAR(255) NOT NULL,
    identification_number VARCHAR(20) UNIQUE,
    passport_number VARCHAR(50),
    email VARCHAR(255) UNIQUE NOT NULL,
    email_verified_at TIMESTAMP NULL,
    password VARCHAR(255) NOT NULL,

    -- Maklumat Organisasi
    position_id BIGINT UNSIGNED,
    grade_id BIGINT UNSIGNED,
    department_id BIGINT UNSIGNED NOT NULL,
    level VARCHAR(10),
    mobile_number VARCHAR(20),

    -- Status dan Keselamatan
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    profile_photo_path VARCHAR(255),
    two_factor_secret TEXT,
    two_factor_recovery_codes TEXT,
    two_factor_confirmed_at TIMESTAMP NULL,
    remember_token VARCHAR(100),

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    deleted_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_users_department (department_id),
    INDEX idx_users_grade (grade_id),
    INDEX idx_users_position (position_id),
    INDEX idx_users_status (status),
    INDEX idx_users_email (email),

    -- Foreign Keys
    FOREIGN KEY (department_id) REFERENCES departments(id),
    FOREIGN KEY (grade_id) REFERENCES grades(id),
    FOREIGN KEY (position_id) REFERENCES positions(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### Komponen Laravel Berkaitan: users

| Komponen       | Lokasi                                         | Tujuan                                      |
| -------------- | ---------------------------------------------- | ------------------------------------------- |
| **Model**      | `app/Models/User.php`                          | Eloquent model dengan hubungan dan accessor |
| **Controller** | `app/Http/Controllers/UserController.php`      | Operasi CRUD pengguna                       |
| **Factory**    | `database/Factories/UserFactory.php`           | Data palsu untuk ujian                      |
| **Seeder**     | `database/Seeders/UserSeeder.php`              | Data awal pengguna                          |
| **Migration**  | `database/migrations/*_create_users_table.php` | Struktur jadual                             |
| **Policy**     | `app/Policies/UserPolicy.php`                  | Kawalan akses dan kebenaran                 |

#### Implementasi Model

```php
<?php

namespace App\Models;

use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use LdapRecord\Models\Concerns\CanAuthenticate;
// use Laravel\Fortify\TwoFactorAuthenticatable;
use Spatie\Permission\Traits\HasRoles;
use OwenIt\Auditing\Contracts\Auditable;

class User extends Authenticatable implements Auditable
{
    use Notifiable, TwoFactorAuthenticatable, HasRoles;
    use \OwenIt\Auditing\Auditable;

    protected $fillable = [
        'name', 'email', 'password', 'title', 'identification_number',
        'department_id', 'grade_id', 'position_id', 'mobile_number', 'status'
    ];

    protected $hidden = [
        'password', 'remember_token', 'two_factor_recovery_codes', 'two_factor_secret'
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'two_factor_confirmed_at' => 'datetime',
    ];

    // Relationships
    public function department()
    {
        return $this->belongsTo(Department::class);
    }

    public function grade()
    {
        return $this->belongsTo(Grade::class);
    }

    public function position()
    {
        return $this->belongsTo(Position::class);
    }

    public function loanApplications()
    {
        return $this->hasMany(LoanApplication::class);
    }

    public function helpdeskTickets()
    {
        return $this->hasMany(HelpdeskTicket::class);
    }
}
```

### 2. Jadual `departments` (Jabatan dan Unit Organisasi)

Menyimpan struktur organisasi MOTAC termasuk ibu pejabat dan pejabat negeri.

#### Struktur Jadual: departments

```sql
CREATE TABLE departments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(20) UNIQUE NOT NULL,
    branch_type ENUM('headquarters', 'state_office', 'unit') NOT NULL,
    description TEXT,
    parent_department_id BIGINT UNSIGNED NULL,
    head_user_id BIGINT UNSIGNED NULL,
    is_active BOOLEAN DEFAULT TRUE,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    deleted_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_departments_code (code),
    INDEX idx_departments_type (branch_type),
    INDEX idx_departments_parent (parent_department_id),
    INDEX idx_departments_active (is_active),

    -- Foreign Keys
    FOREIGN KEY (parent_department_id) REFERENCES departments(id),
    FOREIGN KEY (head_user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

#### Komponen Laravel Berkaitan

| Komponen       | Lokasi                                                | Tujuan                         |
| -------------- | ----------------------------------------------------- | ------------------------------ |
| **Model**      | `app/Models/Department.php`                           | Model dengan hubungan hierarki |
| **Controller** | `app/Http/Controllers/Admin/DepartmentController.php` | Pengurusan jabatan             |
| **Seeder**     | `database/Seeders/DepartmentSeeder.php`               | Data struktur organisasi MOTAC |
| **Resource**   | `app/Filament/Resources/DepartmentResource.php`       | Panel admin Filament           |

### 3. Jadual `positions` (Jawatan)

Menyimpan jawatan dan gelaran dalam organisasi MOTAC.

#### Struktur Jadual: positions

```sql
CREATE TABLE positions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(20) UNIQUE,
    grade_id BIGINT UNSIGNED,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_positions_grade (grade_id),
    INDEX idx_positions_code (code),
    INDEX idx_positions_active (is_active),

    -- Foreign Keys
    FOREIGN KEY (grade_id) REFERENCES grades(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 4. Jadual `grades` (Gred Organisasi)

Menyimpan gred organisasi dengan hierarki kelulusan dan kuasa.

#### Struktur Jadual: grades

```sql
CREATE TABLE grades (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE,
    level INTEGER NOT NULL,
    min_approval_grade_id BIGINT UNSIGNED NULL,
    is_approver_grade BOOLEAN DEFAULT FALSE,
    salary_scheme VARCHAR(50),
    description TEXT,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_grades_level (level),
    INDEX idx_grades_approver (is_approver_grade),
    INDEX idx_grades_min_approval (min_approval_grade_id),

    -- Foreign Keys
    FOREIGN KEY (min_approval_grade_id) REFERENCES grades(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 5. Jadual Pengurusan Peranan (Spatie Laravel Permission)

ICTServe menggunakan pakej Spatie Laravel Permission untuk pengurusan peranan dan kebenaran yang terperinci.

#### Jadual Utama

- `roles` - Peranan sistem (Admin, User, BPM Staff, IT Support)
- `permissions` - Kebenaran granular (create_loan, approve_loan, manage_equipment)
- `model_has_permissions` - Kebenaran langsung untuk pengguna
- `model_has_roles` - Peranan pengguna
- `role_has_permissions` - Kebenaran peranan

## Jadual Pengurusan Peralatan ICT

Jadual untuk menguruskan inventori peralatan ICT, lokasi, dan kategorisasi, selaras dengan prinsip **Teknologi Bersesuaian**, **Fleksibel**, dan **Kandungan Terancang**.

### 6. Jadual `equipment` (Inventori Peralatan)

Menyimpan butiran lengkap semua peralatan ICT yang boleh dipinjam.

#### Struktur Jadual

```sql
CREATE TABLE equipment (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,

    -- Maklumat Asas
    asset_type VARCHAR(100) NOT NULL,
    brand VARCHAR(100),
    model VARCHAR(100),
    serial_number VARCHAR(100) UNIQUE,
    tag_id VARCHAR(50) UNIQUE,
    item_code VARCHAR(50),

    -- Maklumat Pembelian
    purchase_date DATE,
    purchase_price DECIMAL(12,2),
    warranty_expiry_date DATE,
    supplier_name VARCHAR(255),
    acquisition_type ENUM('purchase', 'donation', 'transfer') DEFAULT 'purchase',
    funded_by VARCHAR(100),

    -- Status dan Keadaan
    status ENUM('available', 'on_loan', 'under_maintenance', 'retired', 'damaged', 'lost') DEFAULT 'available',
    condition_status ENUM('excellent', 'good', 'fair', 'poor', 'damaged') DEFAULT 'good',

    -- Lokasi dan Organisasi
    current_location VARCHAR(255),
    department_id BIGINT UNSIGNED,
    location_id BIGINT UNSIGNED,
    equipment_category_id BIGINT UNSIGNED NOT NULL,
    sub_category_id BIGINT UNSIGNED,

    -- Maklumat Tambahan
    description TEXT,
    specifications JSON,
    notes TEXT,
    classification VARCHAR(50),

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    deleted_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_equipment_status (status),
    INDEX idx_equipment_category (equipment_category_id),
    INDEX idx_equipment_department (department_id),
    INDEX idx_equipment_location (location_id),
    INDEX idx_equipment_serial (serial_number),
    INDEX idx_equipment_tag (tag_id),
    FULLTEXT idx_equipment_search (brand, model, description),

    -- Foreign Keys
    FOREIGN KEY (department_id) REFERENCES departments(id),
    FOREIGN KEY (location_id) REFERENCES locations(id),
    FOREIGN KEY (equipment_category_id) REFERENCES equipment_categories(id),
    FOREIGN KEY (sub_category_id) REFERENCES sub_categories(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 7. Jadual `equipment_categories` (Kategori Peralatan)

```sql
CREATE TABLE equipment_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    code VARCHAR(20) UNIQUE,
    description TEXT,
    icon VARCHAR(50),
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_categories_active (is_active),
    INDEX idx_categories_sort (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 8. Jadual `sub_categories` (Sub-kategori Peralatan)

```sql
CREATE TABLE sub_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    equipment_category_id BIGINT UNSIGNED NOT NULL,
    code VARCHAR(20),
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_subcategories_category (equipment_category_id),
    INDEX idx_subcategories_active (is_active),
    UNIQUE KEY unique_category_name (equipment_category_id, name),

    -- Foreign Keys
    FOREIGN KEY (equipment_category_id) REFERENCES equipment_categories(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 9. Jadual `locations` (Lokasi Fizikal)

```sql
CREATE TABLE locations (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    code VARCHAR(20) UNIQUE,
    address TEXT,
    city VARCHAR(100),
    state VARCHAR(100),
    postal_code VARCHAR(10),
    building VARCHAR(100),
    floor VARCHAR(10),
    room VARCHAR(50),
    is_active BOOLEAN DEFAULT TRUE,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_locations_code (code),
    INDEX idx_locations_state (state),
    INDEX idx_locations_active (is_active)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Jadual Modul Pinjaman ICT

Jadual khusus untuk menguruskan kitaran hayat pinjaman peralatan ICT, menepati prinsip **Kawalan Pengguna**, **Fleksibel** dan **Pencegahan Ralat**.

### 10. Jadual `loan_applications` (Permohonan Pinjaman)

```sql
CREATE TABLE loan_applications (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,
    application_number VARCHAR(50) UNIQUE NOT NULL,

    -- Maklumat Pemohon
    user_id BIGINT UNSIGNED NOT NULL,
    responsible_officer_id BIGINT UNSIGNED,
    supporting_officer_id BIGINT UNSIGNED,

    -- Butiran Pinjaman
    purpose TEXT NOT NULL,
    location VARCHAR(255),
    return_location VARCHAR(255),
    loan_start_date DATE NOT NULL,
    loan_end_date DATE NOT NULL,

    -- Status dan Aliran Kerja
    status ENUM('draft', 'submitted', 'pending_support', 'approved', 'rejected',
                'ready_for_issuance', 'issued', 'partially_returned', 'returned',
                'completed', 'cancelled') DEFAULT 'draft',

    -- Maklumat Kelulusan
    approved_by BIGINT UNSIGNED,
    approved_at TIMESTAMP NULL,
    rejection_reason TEXT,
    rejected_by BIGINT UNSIGNED,
    rejected_at TIMESTAMP NULL,

    -- Maklumat Tambahan
    admin_notes TEXT,
    applicant_confirmation_timestamp TIMESTAMP NULL,
    submitted_at TIMESTAMP NULL,
    current_approval_officer_id BIGINT UNSIGNED,
    current_approval_stage VARCHAR(50),

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    deleted_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_loans_user (user_id),
    INDEX idx_loans_status (status),
    INDEX idx_loans_dates (loan_start_date, loan_end_date),
    INDEX idx_loans_approver (approved_by),
    INDEX idx_loans_number (application_number),

    -- Foreign Keys
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (responsible_officer_id) REFERENCES users(id),
    FOREIGN KEY (supporting_officer_id) REFERENCES users(id),
    FOREIGN KEY (approved_by) REFERENCES users(id),
    FOREIGN KEY (rejected_by) REFERENCES users(id),
    FOREIGN KEY (current_approval_officer_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 11. Jadual `loan_application_items` (Item Permohonan)

```sql
CREATE TABLE loan_application_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    loan_application_id BIGINT UNSIGNED NOT NULL,
    equipment_type VARCHAR(100) NOT NULL,
    equipment_category_id BIGINT UNSIGNED,
    quantity_requested INTEGER NOT NULL DEFAULT 1,
    quantity_approved INTEGER DEFAULT 0,
    quantity_issued INTEGER DEFAULT 0,
    quantity_returned INTEGER DEFAULT 0,
    specifications JSON,
    notes TEXT,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_loan_items_application (loan_application_id),
    INDEX idx_loan_items_category (equipment_category_id),

    -- Foreign Keys
    FOREIGN KEY (loan_application_id) REFERENCES loan_applications(id) ON DELETE CASCADE,
    FOREIGN KEY (equipment_category_id) REFERENCES equipment_categories(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 12. Jadual `loan_transactions` (Transaksi Pinjaman)

```sql
CREATE TABLE loan_transactions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,
    loan_application_id BIGINT UNSIGNED NOT NULL,
    transaction_number VARCHAR(50) UNIQUE NOT NULL,

    -- Jenis dan Maklumat Transaksi
    type ENUM('issue', 'return', 'partial_return') NOT NULL,
    transaction_date DATETIME NOT NULL,

    -- Maklumat Pegawai
    issuing_officer_id BIGINT UNSIGNED,
    receiving_officer_id BIGINT UNSIGNED,

    -- Senarai Semak dan Nota
    accessories_checklist_on_issue JSON,
    accessories_checklist_on_return JSON,
    issue_notes TEXT,
    return_notes TEXT,
    condition_notes TEXT,

    -- Status
    status ENUM('pending', 'completed', 'cancelled') DEFAULT 'pending',

    -- Maklumat Lokasi
    pickup_location VARCHAR(255),
    return_location VARCHAR(255),

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_transactions_application (loan_application_id),
    INDEX idx_transactions_type (type),
    INDEX idx_transactions_date (transaction_date),
    INDEX idx_transactions_status (status),
    INDEX idx_transactions_number (transaction_number),

    -- Foreign Keys
    FOREIGN KEY (loan_application_id) REFERENCES loan_applications(id),
    FOREIGN KEY (issuing_officer_id) REFERENCES users(id),
    FOREIGN KEY (receiving_officer_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 13. Jadual `loan_transaction_items` (Item Transaksi)

```sql
CREATE TABLE loan_transaction_items (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    loan_transaction_id BIGINT UNSIGNED NOT NULL,
    equipment_id BIGINT UNSIGNED NOT NULL,
    loan_application_item_id BIGINT UNSIGNED,

    -- Status Item
    status ENUM('issued', 'returned_good', 'returned_damaged', 'lost', 'stolen') NOT NULL,
    condition_on_issue ENUM('excellent', 'good', 'fair', 'poor') DEFAULT 'good',
    condition_on_return ENUM('excellent', 'good', 'fair', 'poor', 'damaged', 'missing'),

    -- Nota
    issue_notes TEXT,
    return_notes TEXT,
    damage_description TEXT,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_transaction_items_transaction (loan_transaction_id),
    INDEX idx_transaction_items_equipment (equipment_id),
    INDEX idx_transaction_items_status (status),

    -- Foreign Keys
    FOREIGN KEY (loan_transaction_id) REFERENCES loan_transactions(id) ON DELETE CASCADE,
    FOREIGN KEY (equipment_id) REFERENCES equipment(id),
    FOREIGN KEY (loan_application_item_id) REFERENCES loan_application_items(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Jadual Modul Helpdesk & Sokongan ICT

Jadual untuk menyokong sistem helpdesk dan pengurusan tiket, berteraskan prinsip **Komunikasi**, **Kawalan Pengguna** dan **Panduan & Dokumentasi**.

### 14. Jadual `helpdesk_tickets` (Tiket Helpdesk)

````sql
CREATE TABLE helpdesk_tickets (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,
    ticket_number VARCHAR(50) UNIQUE NOT NULL,

    -- Maklumat Pelapor
    user_id BIGINT UNSIGNED NOT NULL,
    reporter_name VARCHAR(255),
    reporter_email VARCHAR(255),
    reporter_phone VARCHAR(20),
    department_id BIGINT UNSIGNED,

    -- Maklumat Tiket
    subject VARCHAR(500) NOT NULL,
    description TEXT NOT NULL,
    category_id BIGINT UNSIGNED NOT NULL,
    sub_category_id BIGINT UNSIGNED,

    -- Status dan Keutamaan
    status ENUM('open', 'assigned', 'in_progress', 'pending_user', 'resolved',
                'closed', 'reopened', 'cancelled') DEFAULT 'open',
    priority ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',

    -- Penugasan
    assigned_to_user_id BIGINT UNSIGNED,
    assigned_at TIMESTAMP NULL,
    assigned_by BIGINT UNSIGNED,

    -- SLA dan Masa
    due_date DATETIME,
    first_response_at TIMESTAMP NULL,
    resolved_at TIMESTAMP NULL,
    closed_at TIMESTAMP NULL,

    -- Penyelesaian
    resolution_summary TEXT,
    resolution_notes TEXT,
    satisfaction_rating INTEGER CHECK (satisfaction_rating >= 1 AND satisfaction_rating <= 5),
    satisfaction_feedback TEXT,

    -- Maklumat Teknikal
    affected_systems JSON,
    error_codes JSON,
    attachments JSON,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    deleted_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_tickets_user (user_id),
    INDEX idx_tickets_assigned (assigned_to_user_id),
    INDEX idx_tickets_status (status),
    INDEX idx_tickets_priority (priority),
    INDEX idx_tickets_category (category_id),
    INDEX idx_tickets_number (ticket_number),
    INDEX idx_tickets_due_date (due_date),
    FULLTEXT idx_tickets_search (subject, description),

    -- Foreign Keys
Continuing with the database documentation:

```sql
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (assigned_to_user_id) REFERENCES users(id),
    FOREIGN KEY (category_id) REFERENCES helpdesk_categories(id),
    FOREIGN KEY (sub_category_id) REFERENCES helpdesk_categories(id),
    FOREIGN KEY (department_id) REFERENCES departments(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
````

### 15. Jadual `helpdesk_categories` (Kategori Helpdesk)

```sql
CREATE TABLE helpdesk_categories (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    code VARCHAR(20) UNIQUE,
    description TEXT,
    parent_category_id BIGINT UNSIGNED NULL,
    icon VARCHAR(50),
    color VARCHAR(7), -- Hex color code

    -- SLA Settings
    default_priority ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',
    response_time_hours INTEGER DEFAULT 24,
    resolution_time_hours INTEGER DEFAULT 72,

    -- Status
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INTEGER DEFAULT 0,

    -- Auto Assignment
    auto_assign_to_user_id BIGINT UNSIGNED,
    auto_assign_to_team VARCHAR(50),

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_categories_parent (parent_category_id),
    INDEX idx_categories_active (is_active),
    INDEX idx_categories_code (code),

    -- Foreign Keys
    FOREIGN KEY (parent_category_id) REFERENCES helpdesk_categories(id),
    FOREIGN KEY (auto_assign_to_user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 16. Jadual `helpdesk_comments` (Komen Tiket)

```sql
CREATE TABLE helpdesk_comments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    ticket_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NOT NULL,
    parent_comment_id BIGINT UNSIGNED NULL,

    -- Kandungan Komen
    comment TEXT NOT NULL,
    comment_type ENUM('comment', 'internal_note', 'system_update', 'status_change') DEFAULT 'comment',
    is_internal BOOLEAN DEFAULT FALSE,

    -- Maklumat Tambahan
    attachments JSON,
    time_spent_minutes INTEGER DEFAULT 0,

    -- Status
    is_edited BOOLEAN DEFAULT FALSE,
    edited_at TIMESTAMP NULL,
    edited_by BIGINT UNSIGNED NULL,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_comments_ticket (ticket_id),
    INDEX idx_comments_user (user_id),
    INDEX idx_comments_parent (parent_comment_id),
    INDEX idx_comments_type (comment_type),

    -- Foreign Keys
    FOREIGN KEY (ticket_id) REFERENCES helpdesk_tickets(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (parent_comment_id) REFERENCES helpdesk_comments(id),
    FOREIGN KEY (edited_by) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Jadual Aliran Kerja & Utiliti Berkongsi

Jadual yang menyokong aliran kerja dan fungsi sistem yang digunakan oleh pelbagai modul, menepati prinsip **Struktur Hierarki**, **Kawalan Pengguna**, **Komunikasi** dan **Realistik**.

### 17. Jadual `approvals` (Sistem Kelulusan)

```sql
CREATE TABLE approvals (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    uuid CHAR(36) UNIQUE NOT NULL,

    -- Polimorfik untuk pelbagai jenis kelulusan
    approvable_type VARCHAR(255) NOT NULL,
    approvable_id BIGINT UNSIGNED NOT NULL,

    -- Maklumat Pelulus
    officer_id BIGINT UNSIGNED NOT NULL,
    stage VARCHAR(50) NOT NULL,
    sequence_number INTEGER DEFAULT 1,

    -- Status dan Keputusan
    status ENUM('pending', 'approved', 'rejected', 'delegated', 'expired') DEFAULT 'pending',
    decision_date TIMESTAMP NULL,
    comments TEXT,

    -- Maklumat Delegasi
    delegated_to_user_id BIGINT UNSIGNED NULL,
    delegated_at TIMESTAMP NULL,
    delegation_reason TEXT,

    -- SLA
    due_date TIMESTAMP NULL,
    reminded_at TIMESTAMP NULL,
    escalated_at TIMESTAMP NULL,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,

    -- Indexes
    INDEX idx_approvals_approvable (approvable_type, approvable_id),
    INDEX idx_approvals_officer (officer_id),
    INDEX idx_approvals_status (status),
    INDEX idx_approvals_stage (stage),
    INDEX idx_approvals_due (due_date),

    -- Foreign Keys
    FOREIGN KEY (officer_id) REFERENCES users(id),
    FOREIGN KEY (delegated_to_user_id) REFERENCES users(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 18. Jadual `notifications` (Sistem Notifikasi)

```sql
CREATE TABLE notifications (
    id CHAR(36) PRIMARY KEY,
    type VARCHAR(255) NOT NULL,

    -- Polimorfik untuk pelbagai jenis penerima
    notifiable_type VARCHAR(255) NOT NULL,
    notifiable_id BIGINT UNSIGNED NOT NULL,

    -- Kandungan Notifikasi
    data JSON NOT NULL,
    priority ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium',

    -- Status
    read_at TIMESTAMP NULL,
    archived_at TIMESTAMP NULL,

    -- Saluran Penghantaran
    channels JSON, -- email, database, sms, push
    sent_at JSON, -- record when sent to each channel
    delivery_status JSON, -- success/failed status for each channel

    -- Metadata
    related_type VARCHAR(255) NULL,
    related_id BIGINT UNSIGNED NULL,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    -- Indexes
    INDEX idx_notifications_notifiable (notifiable_type, notifiable_id),
    INDEX idx_notifications_type (type),
    INDEX idx_notifications_read (read_at),
    INDEX idx_notifications_priority (priority),
    INDEX idx_notifications_related (related_type, related_id),
    INDEX idx_notifications_created (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 19. Jadual `settings` (Tetapan Sistem)

```sql
CREATE TABLE settings (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    key_name VARCHAR(100) UNIQUE NOT NULL,
    value TEXT,
    value_type ENUM('string', 'integer', 'boolean', 'json', 'array') DEFAULT 'string',
    category VARCHAR(50) DEFAULT 'general',
    description TEXT,
    is_public BOOLEAN DEFAULT FALSE,
    is_editable BOOLEAN DEFAULT TRUE,

    -- Validation
    validation_rules JSON,
    default_value TEXT,

    -- Audit Fields
    created_by BIGINT UNSIGNED,
    updated_by BIGINT UNSIGNED,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    -- Indexes
    INDEX idx_settings_category (category),
    INDEX idx_settings_public (is_public),
    INDEX idx_settings_editable (is_editable)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

### 20. Jadual `activity_logs` (Log Aktiviti)

```sql
CREATE TABLE activity_logs (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,

    -- Maklumat Pengguna
    user_id BIGINT UNSIGNED,
    user_type VARCHAR(255),
    user_name VARCHAR(255),

    -- Maklumat Aktiviti
    log_name VARCHAR(100),
    description TEXT NOT NULL,
    event VARCHAR(50) NOT NULL,

    -- Maklumat Model (Polimorfik)
    subject_type VARCHAR(255),
    subject_id BIGINT UNSIGNED,
    causer_type VARCHAR(255),
    causer_id BIGINT UNSIGNED,

    -- Data Perubahan
    properties JSON,
    batch_uuid CHAR(36),

    -- Maklumat Sistem
    ip_address VARCHAR(45),
    user_agent TEXT,
    url TEXT,
    method VARCHAR(10),

    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- Indexes
    INDEX idx_activity_user (user_id),
    INDEX idx_activity_subject (subject_type, subject_id),
    INDEX idx_activity_causer (causer_type, causer_id),
    INDEX idx_activity_event (event),
    INDEX idx_activity_log_name (log_name),
    INDEX idx_activity_created (created_at),
    INDEX idx_activity_batch (batch_uuid),

    -- Foreign Keys
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
```

## Senarai Semak Pematuhan

Berikut adalah senarai semak untuk memastikan reka bentuk pangkalan data mematuhi prinsip-prinsip reka bentuk kerajaan:

| Prinsip                   | Status | Implementasi                                     | Catatan                             |
| ------------------------- | ------ | ------------------------------------------------ | ----------------------------------- |
| **Berpaksikan Rakyat**    | ✅     | Struktur data memudahkan UI mesra pengguna       | Medan deskriptif, hubungan jelas    |
| **Berpacukan Data**       | ✅     | Audit trail lengkap, timestamps, jejak perubahan | Laravel Auditing terintegrasi       |
| **Kandungan Terancang**   | ✅     | Penamaan konsisten, dokumentasi medan lengkap    | Konvensyen penamaan standard        |
| **Teknologi Bersesuaian** | ✅     | Laravel Eloquent ORM, MySQL 8.0+                 | Best practices framework            |
| **Antara Muka Minimalis** | ✅     | Struktur data menyokong UI ringkas               | Normalisasi yang sesuai             |
| **Seragam**               | ✅     | Konvensyen konsisten merentasi jadual            | Pattern yang sama untuk semua modul |
| **Paparan/Menu Jelas**    | ✅     | Medan sokongan navigasi dan breadcrumbs          | Status, hierarki jelas              |
| **Realistik**             | ✅     | Model mengikut proses perniagaan sebenar         | Berdasarkan aliran kerja MOTAC      |
| **Kognitif**              | ✅     | Struktur mengurangkan kompleksiti                | Hubungan logik dan intuitif         |
| **Fleksibel**             | ✅     | JSON fields, polimorfik, extensible              | Sokongan keperluan masa depan       |
| **Komunikasi**            | ✅     | Sistem notifikasi dan komen terintegrasi         | Multi-channel notifications         |
| **Struktur Hierarki**     | ✅     | Model organisasi dan peranan berhierarki         | Parent-child relationships          |
| **Komponen UI/UX**        | ✅     | Data menyokong komponen standard                 | Integration dengan design system    |
| **Tipografi**             | ✅     | Medan teks dengan formatting support             | Rich text dan markdown ready        |
| **Tetapan Lalai**         | ✅     | Default values dan sistem settings               | Smart defaults                      |
| **Kawalan Pengguna**      | ✅     | RBAC dengan Spatie Permission                    | Granular permissions                |
| **Pencegahan Ralat**      | ✅     | Constraints, validasi, foreign keys              | Data integrity enforced             |
| **Panduan & Dokumentasi** | ✅     | Dokumentasi lengkap ini                          | Self-documenting schema             |

## Panduan Pelaksanaan

### Pelaksanaan Migration

```php
<?php
// Contoh migration untuk jadual users
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up()
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->uuid('uuid')->unique();
            $table->string('title', 50)->nullable();
            $table->string('name');
            $table->string('identification_number', 20)->unique()->nullable();
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');

            // Organisasi
            $table->foreignId('department_id')->constrained();
            $table->foreignId('grade_id')->nullable()->constrained();
            $table->foreignId('position_id')->nullable()->constrained();

            // Status
            $table->enum('status', ['active', 'inactive', 'suspended'])
                  ->default('active');

            // Audit fields
            $table->foreignId('created_by')->nullable()->constrained('users');
            $table->foreignId('updated_by')->nullable()->constrained('users');
            $table->foreignId('deleted_by')->nullable()->constrained('users');

            $table->timestamps();
            $table->softDeletes();

            // Indexes
            $table->index(['department_id', 'status']);
            $table->index('email');
        });
    }

    public function down()
    {
        Schema::dropIfExists('users');
    }
};
```

### Pelaksanaan Seeder

```php
<?php
// database/seeders/DepartmentSeeder.php
namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Department;

class DepartmentSeeder extends Seeder
{
    public function run()
    {
        $departments = [
            [
                'name' => 'Bahagian Pengurusan Maklumat',
                'code' => 'BPM',
                'branch_type' => 'headquarters',
                'description' => 'Menguruskan sistem maklumat dan ICT MOTAC'
            ],
            [
                'name' => 'Bahagian Pentadbiran',
                'code' => 'BP',
                'branch_type' => 'headquarters',
                'description' => 'Menguruskan hal ehwal pentadbiran'
            ]
            // ... more departments
        ];

        foreach ($departments as $dept) {
            Department::create($dept);
        }
    }
}
```

### Pelaksanaan Model dengan Hubungan

```php
<?php
// app/Models/LoanApplication.php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;
use OwenIt\Auditing\Contracts\Auditable;

class LoanApplication extends Model implements Auditable
{
    use SoftDeletes, \OwenIt\Auditing\Auditable;

    protected $fillable = [
        'user_id', 'purpose', 'location', 'loan_start_date',
        'loan_end_date', 'status'
    ];

    protected $casts = [
        'loan_start_date' => 'date',
        'loan_end_date' => 'date',
        'submitted_at' => 'datetime',
        'approved_at' => 'datetime',
    ];

    // Relationships
    public function user()
    {
        return $this->belongsTo(User::class);
    }

    public function items()
    {
        return $this->hasMany(LoanApplicationItem::class);
    }

    public function transactions()
    {
        return $this->hasMany(LoanTransaction::class);
    }

    public function approvals()
    {
        return $this->morphMany(Approval::class, 'approvable');
    }

    // Scopes
    public function scopePending($query)
    {
        return $query->where('status', 'pending_support');
    }

    public function scopeApproved($query)
    {
        return $query->where('status', 'approved');
    }

    // Accessors
    public function getFormattedApplicationNumberAttribute()
    {
        return 'LA-' . str_pad($this->id, 6, '0', STR_PAD_LEFT);
    }
}
```

### Optimasi Prestasi

#### Indexing Strategy

```sql
-- Indexes untuk prestasi optimum
CREATE INDEX idx_composite_loan_search
ON loan_applications(status, created_at, user_id);

CREATE INDEX idx_equipment_availability
ON equipment(status, equipment_category_id, location_id);

CREATE INDEX idx_ticket_assignment
ON helpdesk_tickets(status, assigned_to_user_id, priority, created_at);

-- Full-text search untuk carian lanjutan
ALTER TABLE equipment
ADD FULLTEXT(brand, model, description);

ALTER TABLE helpdesk_tickets
ADD FULLTEXT(subject, description);
```

#### Query Optimization

```php
<?php
// Gunakan eager loading untuk mengelakkan N+1 queries
$applications = LoanApplication::with([
    'user:id,name,department_id',
    'user.department:id,name',
    'items.category:id,name',
    'approvals.officer:id,name'
])->where('status', 'pending_support')
  ->orderBy('created_at', 'desc')
  ->paginate(20);

// Gunakan select specific columns
$equipment = Equipment::select([
    'id', 'brand', 'model', 'status', 'equipment_category_id'
])->where('status', 'available')
  ->with('category:id,name')
  ->get();
```

### Backup dan Maintenance

#### Backup Strategy

```bash
#!/bin/bash
# Backup script harian
DATE=$(date +%Y%m%d)
BACKUP_DIR="/backup/ictserve"

# Backup struktur dan data
mysqldump -h localhost -u ictserve_user -p \
  --single-transaction \
  --routines \
  --triggers \
  --events \
  ictserve > ${BACKUP_DIR}/ictserve_full_${DATE}.sql

# Backup data sahaja (untuk restore cepat)
mysqldump -h localhost -u ictserve_user -p \
  --no-create-info \
  --skip-triggers \
  ictserve > ${BACKUP_DIR}/ictserve_data_${DATE}.sql

# Compress backups
gzip ${BACKUP_DIR}/ictserve_*_${DATE}.sql

# Cleanup backup lama (simpan 30 hari)
find ${BACKUP_DIR} -name "ictserve_*.sql.gz" -mtime +30 -delete
```

#### Maintenance Tasks

```sql
-- Optimasi jadual bulanan
OPTIMIZE TABLE users, departments, equipment, loan_applications, helpdesk_tickets;

-- Analisa dan repair jika perlu
ANALYZE TABLE users, equipment, loan_applications;

-- Pembersihan data lama (log aktiviti > 1 tahun)
DELETE FROM activity_logs
WHERE created_at < DATE_SUB(NOW(), INTERVAL 1 YEAR);

-- Update statistik
UPDATE TABLE statistics;
```

## Sejarah Revisi

| Versi | Tarikh            | Pengarang        | Perubahan                                                      |
| ----- | ----------------- | ---------------- | -------------------------------------------------------------- |
| 2.0   | 26 September 2025 | Pasukan ICTServe | Kemas kini komprehensif, tambah jadual baru, optimasi prestasi |
| 1.5   | 15 Ogos 2025      | Pasukan ICTServe | Penambahbaikan struktur audit, keselamatan                     |
| 1.0   | 12 Jun 2025       | Pasukan ICTServe | Versi awal dokumentasi                                         |

## Sokongan dan Bantuan

### Hubungan Teknikal

| Jenis Sokongan        | Hubungan                         | Waktu Operasi     |
| --------------------- | -------------------------------- | ----------------- |
| **Sokongan Database** | <db-admin@ictserve.motac.gov.my> | 8:00 AM - 5:00 PM |
| **Sokongan Aplikasi** | <support@ictserve.motac.gov.my>  | 24/7              |
| **Dokumentasi**       | <docs@ictserve.motac.gov.my>     | 8:00 AM - 5:00 PM |

### Sumber Tambahan

- [Dokumentasi Laravel Eloquent](https://laravel.com/docs/eloquent)
- [Panduan MySQL 8.0](https://dev.mysql.com/doc/refman/8.0/en/)
- [Spatie Laravel Permission](https://spatie.be/docs/laravel-permission/v6/introduction)
- [Laravel Auditing](https://laravel-auditing.com/)

### Glosari Teknikal

| Istilah          | Definisi                                                                   |
| ---------------- | -------------------------------------------------------------------------- |
| **Eloquent ORM** | Object-Relational Mapping Laravel untuk berinteraksi dengan pangkalan data |
| **Soft Delete**  | Penandaan rekod sebagai dipadam tanpa menghapus dari pangkalan data        |
| **Polymorphic**  | Hubungan yang membolehkan model berkaitan dengan berbagai jenis model lain |
| **Migration**    | Skrip Laravel untuk mengurus perubahan skema pangkalan data                |
| **Seeder**       | Kelas Laravel untuk mengisi pangkalan data dengan data awal                |
| **Audit Trail**  | Rekod lengkap perubahan data untuk tujuan audit                            |

---

**Nota Penutup:** Dokumen ini akan dikemas kini secara berkala mengikut perubahan keperluan sistem dan penambahbaikan teknologi. Sila rujuk versi terkini dalam repositori sistem untuk maklumat yang paling tepat.

---

## Ringkasan Penambahbaikan Utama

Berikut adalah penambahbaikan utama yang telah diaplikasikan pada dokumentasi:

### 1. **Struktur dan Organisasi**

- Tambah metadata dokumen lengkap dengan versi, tarikh, dan sasaran audiens
- Susun semula kandungan dengan hierarki yang jelas dan navigasi mudah
- Tambah seksyen prasyarat dan keperluan sistem
- Sediakan glosari teknikal untuk istilah khusus

### 2. **Teknikal dan Keakuratan**

- Kemas kini struktur jadual dengan constraint dan foreign key yang lengkap
- Tambah field audit yang komprehensif untuk semua jadual
- Sediakan indexing strategy untuk optimasi prestasi
- Tambah field JSON untuk sokongan data semi-structured

### 3. **Implementasi Praktis**

- Sediakan contoh kod Laravel Migration yang lengkap
- Tambah contoh Model dengan relationship dan scope
- Sediakan strategi backup dan maintenance
- Tambah panduan optimasi prestasi dengan contoh query

### 4. **Dokumentasi Standard Industri**

- Format markdown yang konsisten dan profesional
- Jadual yang terstruktur dan mudah dibaca
- Diagram ASCII dan Mermaid untuk visualisasi
- Rujukan silang antara komponen

### 5. **Kebolehgunaan dan Aksesibiliti**

- Bahasa yang jelas tetapi teknikal yang tepat
- Seksyen sokongan dan bantuan yang komprehensif
- Sejarah revisi untuk jejak perubahan
- Hubungan dengan prinsip reka bentuk kerajaan yang jelas

### 6. **Keselamatan dan Pematuhan**

- Audit trail yang komprehensif
- Constraint dan validation rules
- Dokumentasi RBAC dan permission system
- Backup dan disaster recovery procedures

Dokumentasi yang diperbaiki ini kini mematuhi standard industri untuk dokumentasi teknikal dan sesuai untuk digunakan oleh pembangun dalaman mahupun luaran.
